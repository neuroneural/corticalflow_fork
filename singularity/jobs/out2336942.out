[2023-03-15 23:23:44,192][__main__][INFO] - Predicting surfaces with Cortical Flow
Config:
user_config: null
inputs:
  data_type: formatted
  path: /subj/
  split_name: test
  split_file: /corticalflow/subjs.csv
  hemisphere: lh
  device: cuda:0
  template: /corticalflow/resources/smooth_templates/lh_white_smooth_380k.obj
white_model:
  nb_features:
  - - - 16
      - 32
      - 32
      - 32
    - - 32
      - 32
      - 32
      - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  integration_method: RK4
  integration_steps: 30
  share_flows: true
  model_checkpoint: /corticalflow/resources/trained_models/CFPP_LEFT_WHITE.pth
pial_model:
  nb_features:
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  integration_method: RK4
  integration_steps: 30
  share_flows: true
  model_checkpoint: /corticalflow/resources/trained_models/CFPP_LEFT_PIAL.pth
outputs:
  output_dir: /data/users2/washbee/corticalflow/cfpp/output_lh/
  out_deform:
  - 0
  - 1
  - 2
  out_format: freesurfer

[2023-03-15 23:23:44,193][__main__][INFO] - loading from formatted dataset...
[2023-03-15 23:23:44,197][__main__][INFO] - 1 subjects loaded for test in 0.0042 secs
[2023-03-15 23:23:42,752][__main__][INFO] - Template mesh <trimesh.Trimesh(vertices.shape=(379970, 3), faces.shape=(759936, 3))> read from /corticalflow/resources/smooth_templates/lh_white_smooth_380k.obj

*********empty cache, before loading white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.75% free): 11811160064(total), 11545673728 (free), 265486336 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0

_checkpoint: /corticalflow/resources/trained_models/CFPP_LEFT_WHITE.pth
pial_model:
  nb_features:
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  integration_method: RK4
  integration_steps: 30
  share_flows: true
  model_checkpoint: /corticalflow/resources/trained_models/CFPP_LEFT_PIAL.pth
outputs:
  output_dir: /data/users2/washbee/corticalflow/cfpp/output_lh/
  out_deform:
  - 0
  - 1
  - 2
  out_format: freesurfer

[2023-03-15 23:23:36,117][__main__][INFO] - loading from formatted dataset...
[2023-03-15 23:23:36,121][__main__][INFO] - 1 subjects loaded for test in 0.0042 secs
[2023-03-15 23:23:38,733][__main__][INFO] - Template mesh <trimesh.Trimesh(vertices.shape=(379970, 3), faces.shape=(759936, 3))> read from /corticalflow/resources/smooth_templates/lh_white_smooth_380k.obj

*********empty cache, before loading white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0


*********after loading white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.41% free): 11811160064(total), 10678370304 (free), 1132789760 (used)
Max Memory occupied by tensors: 2093056
Max Memory Cached: 2097152
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 2097152

[2023-03-15 23:23:40,668][__main__][INFO] - 1.9324 secs for white model setup:
CorticalFlow(
  (deform_blocks): ModuleList(
    (0): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(1, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (2): ConvBlock(
            (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (3): ConvBlock(
            (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(64, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (2): Sequential(
            (0): ConvBlock(
              (main): Conv3d(64, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (3): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(33, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(32, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (2): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (1): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(4, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(36, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (2): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(7, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(39, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
  )
)
[2023-03-15 23:23:40,669][__main__][INFO] - White model Total number of parameters: 519865
[2023-03-15 23:23:40,686][__main__][INFO] - White Model weights at deformation train 2 iteration 65000 and validation metric 0.0000 loaded from /corticalflow/resources/trained_models/CFPP_LEFT_WHITE.pth in 0.0167 secs
white model size





model size: 1.983MB






*********empty cache, before loading pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.41% free): 11811160064(total), 10678370304 (free), 1132789760 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 2097152


*********after loading pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.39% free): 11811160064(total), 10676273152 (free), 1134886912 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 4194304

[2023-03-15 23:23:40,705][__main__][INFO] - 0.0151 secs for white model setup:
CorticalFlow(
  (deform_blocks): ModuleList(
    (0): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(1, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(33, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (1): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(4, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(36, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (2): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(7, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(39, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
  )
)
[2023-03-15 23:23:40,705][__main__][INFO] - Pial model Total number of parameters: 325737
[2023-03-15 23:23:40,719][__main__][INFO] - Pial Model weights at deformation train 2 iteration 50000 and validation metric 0.0000 loaded from /corticalflow/resources/trained_models/CFPP_LEFT_PIAL.pth in 0.0133 secs
pial model size





model size: 1.243MB





0 - override config
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.82% free): 11811160064(total), 11553800192 (free), 257359872 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - read MRI
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - load template mesh
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - setup white model
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - print white model size
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 6291456




0 - setup pial model
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 6291456




0 - print print pial model size
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5619712
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 6291456




0 - End
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5619712
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 6291456




[2023-03-15 23:23:40,721][__main__][INFO] - predicting...

*********before white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.09% free): 11811160064(total), 10640621568 (free), 1170538496 (used)
Max Memory occupied by tensors: 29670400
Max Memory Cached: 39845888
Current Memory occupied by tensors: 29670400
Current Memory cached occupied by tensors: 39845888


*********emptying cache , before white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.11% free): 11811160064(total), 10642718720 (free), 1168441344 (used)
Max Memory occupied by tensors: 29670400
Max Memory Cached: 39845888
Current Memory occupied by tensors: 29670400
Current Memory cached occupied by tensors: 37748736


*********after white model()…. 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.29% free): 11811160064(total), 8302297088 (free), 3508862976 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.29% free): 11811160064(total), 8302297088 (free), 3508862976 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********emptying cache , before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (84.80% free): 11811160064(total), 10015670272 (free), 1795489792 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 211812352

Checked. Pial Model is not None. We have Pial Model.

*********after pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (67.66% free): 11811160064(total), 7991918592 (free), 3819241472 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 2235564032
Current Memory occupied by tensors: 81412096
Current Memory cached occupied by tensors: 2235564032

[2023-03-15 23:23:42,927][__main__][INFO] - 2.056991 total seconds for batch.
[2023-03-15 23:23:48,328][__main__][INFO] - Predicting surfaces with Cortical Flow
Config:
user_config: null
inputs:
  data_type: formatted
  path: /subj/
  split_name: test
  split_file: /corticalflow/subjs.csv
  hemisphere: lh
  device: cuda:0
  template: /corticalflow/resources/smooth_templates/lh_white_smooth_380k.obj
white_model:
  nb_features:
  - - - 16
      - 32
      - 32
      - 32
    - - 32
      - 32
      - 32
      - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  integration_method: RK4
  integration_steps: 30
  share_flows: true
  model_checkpoint: /corticalflow/resources/trained_models/CFPP_LEFT_WHITE.pth
pial_model:
  nb_features:
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  - - - 16
      - 32
    - - 32
      - 32
      - 16
      - 16
  integration_method: RK4
  integration_steps: 30
  share_flows: true
  model_checkpoint: /corticalflow/resources/trained_models/CFPP_LEFT_PIAL.pth
outputs:
  output_dir: /data/users2/washbee/corticalflow/cfpp/output_lh/
  out_deform:
  - 0
  - 1
  - 2
  out_format: freesurfer

[2023-03-15 23:23:48,329][__main__][INFO] - loading from formatted dataset...
[2023-03-15 23:23:48,333][__main__][INFO] - 1 subjects loaded for test in 0.0042 secs
[2023-03-15 23:23:49,339][__main__][INFO] - Template mesh <trimesh.Trimesh(vertices.shape=(379970, 3), faces.shape=(759936, 3))> read from /corticalflow/resources/smooth_templates/lh_white_smooth_380k.obj

*********empty cache, before loading white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0

size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(64, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (2): Sequential(
            (0): ConvBlock(
              (main): Conv3d(64, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (3): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(33, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(32, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (2): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (1): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(4, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(36, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (2): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(7, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(39, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
  )
)
[2023-03-15 23:23:48,735][__main__][INFO] - White model Total number of parameters: 519865
[2023-03-15 23:23:48,752][__main__][INFO] - White Model weights at deformation train 2 iteration 65000 and validation metric 0.0000 loaded from /corticalflow/resources/trained_models/CFPP_LEFT_WHITE.pth in 0.0165 secs
white model size





model size: 1.983MB






*********empty cache, before loading pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10673258496 (free), 1137901568 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 2097152


*********after loading pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.35% free): 11811160064(total), 10671161344 (free), 1139998720 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 4194304

[2023-03-15 23:23:48,771][__main__][INFO] - 0.0152 secs for white model setup:
CorticalFlow(
  (deform_blocks): ModuleList(
    (0): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(1, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(33, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (1): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(4, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(36, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (2): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(7, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(39, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
  )
)
[2023-03-15 23:23:48,771][__main__][INFO] - Pial model Total number of parameters: 325737
[2023-03-15 23:23:48,785][__main__][INFO] - Pial Model weights at deformation train 2 iteration 50000 and validation metric 0.0000 loaded from /corticalflow/resources/trained_models/CFPP_LEFT_PIAL.pth in 0.0133 secs
pial model size





model size: 1.243MB





0 - override config
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.78% free): 11811160064(total), 11548622848 (free), 262537216 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - read MRI
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.75% free): 11811160064(total), 11545673728 (free), 265486336 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - load template mesh
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.75% free): 11811160064(total), 11545673728 (free), 265486336 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - setup white model
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.75% free): 11811160064(total), 11545673728 (free), 265486336 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - print white model size
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.33% free): 11811160064(total), 10669064192 (free), 1142095872 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 6291456




0 - setup pial model
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.33% free): 11811160064(total), 10669064192 (free), 1142095872 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 6291456




0 - print print pial model size
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.33% free): 11811160064(total), 10669064192 (free), 1142095872 (used)
Max Memory occupied by tensors: 5619712
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 6291456




0 - End
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.33% free): 11811160064(total), 10669064192 (free), 1142095872 (used)
Max Memory occupied by tensors: 5619712
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 6291456




[2023-03-15 23:23:48,787][__main__][INFO] - predicting...

*********before white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.05% free): 11811160064(total), 10635509760 (free), 1175650304 (used)
Max Memory occupied by tensors: 29670400
Max Memory Cached: 39845888
Current Memory occupied by tensors: 29670400
Current Memory cached occupied by tensors: 39845888


*********emptying cache , before white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.06% free): 11811160064(total), 10637606912 (free), 1173553152 (used)
Max Memory occupied by tensors: 29670400
Max Memory Cached: 39845888
Current Memory occupied by tensors: 29670400
Current Memory cached occupied by tensors: 37748736

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
*********after white model()…. 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.29% free): 11811160064(total), 8302297088 (free), 3508862976 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.29% free): 11811160064(total), 8302297088 (free), 3508862976 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********emptying cache , before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (84.80% free): 11811160064(total), 10015670272 (free), 1795489792 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 211812352

Checked. Pial Model is not None. We have Pial Model.

*********after pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (67.66% free): 11811160064(total), 7991918592 (free), 3819241472 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 2235564032
Current Memory occupied by tensors: 81412096
Current Memory cached occupied by tensors: 2235564032

[2023-03-15 23:23:48,820][__main__][INFO] - 2.047691 total seconds for batch.

*********after white model()…. 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.25% free): 11811160064(total), 8297185280 (free), 3513974784 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.25% free): 11811160064(total), 8297185280 (free), 3513974784 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********emptying cache , before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (84.76% free): 11811160064(total), 10010558464 (free), 1800601600 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 211812352

Checked. Pial Model is not None. We have Pial Model.
[2023-03-15 23:23:50,976][__main__][INFO] - Template mesh <trimesh.Trimesh(vertices.shape=(379970, 3), faces.shape=(759936, 3))> read from /corticalflow/resources/smooth_templates/lh_white_smooth_380k.obj

*********empty cache, before loading white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0


*********after loading white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.41% free): 11811160064(total), 10678370304 (free), 1132789760 (used)
Max Memory occupied by tensors: 2093056
Max Memory Cached: 2097152
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 2097152

[2023-03-15 23:23:52,957][__main__][INFO] - 1.9783 secs for white model setup:
CorticalFlow(
  (deform_blocks): ModuleList(
    (0): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(1, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (2): ConvBlock(
            (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (3): ConvBlock(
            (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(64, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (2): Sequential(
            (0): ConvBlock(
              (main): Conv3d(64, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (3): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(33, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(32, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (2): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (1): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(4, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(36, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (2): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(7, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(39, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
  )
)
[2023-03-15 23:23:52,958][__main__][INFO] - White model Total number of parameters: 519865
[2023-03-15 23:23:52,975][__main__][INFO] - White Model weights at deformation train 2 iteration 65000 and validation metric 0.0000 loaded from /corticalflow/resources/trained_models/CFPP_LEFT_WHITE.pth in 0.0165 secs
white model size





model size: 1.983MB






*********empty cache, before loading pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.41% free): 11811160064(total), 10678370304 (free), 1132789760 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 2097152


*********after loading pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.39% free): 11811160064(total), 10676273152 (free), 1134886912 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 4194304

[2023-03-15 23:23:52,993][__main__][INFO] - 0.0151 secs for white model setup:
CorticalFlow(
  (deform_blocks): ModuleList(
    (0): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(1, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(33, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (1): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(4, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(36, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
    (2): DeformationBlock(
      (encoder): Unet(
        (downarm): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(7, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
        (uparm): ModuleList(
          (0): Sequential(
            (0): ConvBlock(
              (main): Conv3d(32, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
          (1): Sequential(
            (0): ConvBlock(
              (main): Conv3d(48, 32, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
              (activation): LeakyReLU(negative_slope=0.2)
            )
            (1): Upsample(scale_factor=2.0, mode=nearest)
          )
        )
        (extras): ModuleList(
          (0): ConvBlock(
            (main): Conv3d(39, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
          (1): ConvBlock(
            (main): Conv3d(16, 16, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
            (activation): LeakyReLU(negative_slope=0.2)
          )
        )
      )
      (flow): Conv3d(16, 3, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
      (deformer): DiffeoMeshDeformer(
        (integrate): IntegratePointWiseRK4(
          (interpolator): PointPooling()
        )
      )
    )
  )
)
[2023-03-15 23:23:52,994][__main__][INFO] - Pial model Total number of parameters: 325737
[2023-03-15 23:23:53,007][__main__][INFO] - Pial Model weights at deformation train 2 iteration 50000 and validation metric 0.0000 loaded from /corticalflow/resources/trained_models/CFPP_LEFT_PIAL.pth in 0.0134 secs
pial model size





model size: 1.243MB





0 - override config
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.82% free): 11811160064(total), 11553800192 (free), 257359872 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - read MRI
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - load template mesh
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - setup white model
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - print white model size
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 6291456




0 - setup pial model
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5083136
Max Memory Cached: 6291456
Current Memory occupied by tensors: 2093056
Current Memory cached occupied by tensors: 6291456




0 - print print pial model size
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5619712
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 6291456




0 - End
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.37% free): 11811160064(total), 10674176000 (free), 1136984064 (used)
Max Memory occupied by tensors: 5619712
Max Memory Cached: 6291456
Current Memory occupied by tensors: 3407872
Current Memory cached occupied by tensors: 6291456




[2023-03-15 23:23:53,010][__main__][INFO] - predicting...

*********before white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.09% free): 11811160064(total), 10640621568 (free), 1170538496 (used)
Max Memory occupied by tensors: 29670400
Max Memory Cached: 39845888
Current Memory occupied by tensors: 29670400
Current Memory cached occupied by tensors: 39845888


*********emptying cache , before white model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (90.11% free): 11811160064(total), 10642718720 (free), 1168441344 (used)
Max Memory occupied by tensors: 29670400
Max Memory Cached: 39845888
Current Memory occupied by tensors: 29670400
Current Memory cached occupied by tensors: 37748736

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
*********after white model()…. 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.29% free): 11811160064(total), 8302297088 (free), 3508862976 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (70.29% free): 11811160064(total), 8302297088 (free), 3508862976 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 1925185536


*********emptying cache , before pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (84.80% free): 11811160064(total), 10015670272 (free), 1795489792 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 1925185536
Current Memory occupied by tensors: 62275072
Current Memory cached occupied by tensors: 211812352

Checked. Pial Model is not None. We have Pial Model.

*********after pial model() 
 
Device 0: NVIDIA GeForce RTX 2080 Ti, Memory : (67.66% free): 11811160064(total), 7991918592 (free), 3819241472 (used)
Max Memory occupied by tensors: 1228008448
Max Memory Cached: 2235564032
Current Memory occupied by tensors: 81412096
Current Memory cached occupied by tensors: 2235564032

[2023-03-15 23:23:55,259][__main__][INFO] - 2.097134 total seconds for batch.
